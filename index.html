<!DOCTYPE html>
<html lang="en" onmousemove="getCursor(event)">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sprite Sheet Animation</title>
    <!-- Stylesheet -->
    <link rel="stylesheet" href="style.css" />
    <link rel="prefetch" href="stand.png" />
    <link rel="prefetch" href="sleep.png" />
    <link rel="prefetch" href="lie.png" />
    <link rel="prefetch" href="walk.png" />
  </head>
  <body>
    <!--h1 id="b">test</h1-->
    <div id="a" class="container anim" onclick="switcher()"></div>
  </body>
</html>

<script>
let interval = null;
let state = "sit";
var rect = document.getElementById('a').getBoundingClientRect();
console.log(rect.left, rect.right);

document.getElementById('a').style.animationDuration = "0.5s";
let timeout = setTimeout(slower, 1000);

document.getElementById('b').style.position = "absolute";
document.getElementById('b').style.left = rect.left + "px";
document.getElementById('b').style.top = rect.top - 120 + "px";

window.addEventListener('resize', function(event) {
    rect = document.getElementById('a').getBoundingClientRect();
}, true);

    function switcher(){
	document.getElementById('a').classList.add('anim');
	document.getElementById('a').classList.remove('noanim');
	document.getElementById('a').style.backgroundRepeat = "repeat";
	if (state === "sit") {
		clearTimeout(timeout);
		document.getElementById('a').style.backgroundImage = "url('stand.png')";
		document.getElementById('a').style.animationDuration = "0.4s";
		state = "stand";
		timeout = setTimeout(slower, 1000);
	} else if (state === "stand") {
		clearTimeout(timeout);
        	document.getElementById('a').style.backgroundImage = "url('lie.png')";
		document.getElementById('a').style.animationDuration = "0.6s";
		state = "lie";	
		timeout = setTimeout(slower, 1000);
	} else if (state === "lie") {
		clearTimeout(timeout);
	        document.getElementById('a').style.backgroundImage = "url('sleep.png')";
		state = "sleep";
		document.getElementById('a').style.animationDuration = "2.8s";
	} else if (state === "sleep") {
		clearTimeout(timeout);
		document.getElementById('a').style.backgroundImage = "url('sit.png')";
		document.getElementById('a').style.animationDuration = "0.5s";	
		state = "sit";
		timeout = setTimeout(slower, 1000);
	}
    }

    function getCursor(event) {
		let x = event.clientX;
		let y = event.clientY;
		if (state != "sleep") {
				if (x < rect.left + 20) {
					document.getElementById('a').style.transform = "scaleX(-1)";
				} else if (x > rect.right - 20) {
				document.getElementById('a').style.transform = "scaleX(1)";
				} else if (y > rect.top) {
			console.log("good boy");
			document.getElementById('a').style.animationDuration = "0.5s";
			}
		}
		
		if (state === "stand") {
			if (x < document.getElementById('a').getBoundingClientRect().left - 200 || x > document.getElementById('a').getBoundingClientRect().right + 200) {
				document.getElementById('a').style.backgroundImage = "url('walk.png')";
				document.getElementById('a').style.animationDuration = "0.6s";
				walkies(x);
			}
		}
    }
	
	var id = null;
	function walkies(x) {
		console.log("x, " + x);
		var elem = document.getElementById('a');
		var pos;
		pos = (Math.sign(x - pos) > 0) ? elem.getBoundingClientRect().right:elem.getBoundingClientRect().left;
		document.getElementById('a').style.transform = "scaleX(" + Math.sign(x - pos) + ")";
		clearInterval(id);
		id = setInterval(frame, 5);
		
		function frame() {
			if (pos - x < 50 && x - pos < 160) {
				clearInterval(id);
				document.getElementById('a').style.backgroundImage = "url('stand.png')";
			} else {
			  pos += Math.sign(x - pos) * 5;
  			  elem.style.left = pos + 'px';
			}
	  }
	}
	
	function slower()
	{
		/*let x = document.getElementById('a').style.animationDuration;
		x = x.replace("s","")
		console.log(x + " " + state);
		let dur = parseFloat(x) * 1.5;
		console.log(dur);
		document.getElementById('a').style.animationDuration = dur.toString() + "s";
		console.log("halved" + " " + dur);
		if (dur < 3) {
			setTimeout(slower, 1000);
		} else {
			clearTimeout(timeout);
			document.getElementById('a').classList.remove('anim');
			document.getElementById('a').classList.add('noanim');
			document.getElementById('a').style.backgroundImage = "url('rest.png')";
			
			if (state === "lie") {
				document.getElementById('a').style.backgroundPosition = "0 -180px";
			} else if (state === "sit") {
				document.getElementById('a').style.backgroundPosition = "0 0px";
			} else if (state === "stand") {
				document.getElementById('a').style.backgroundPosition = "0 -90px";
			}
		}
		*/
	}
</script>
